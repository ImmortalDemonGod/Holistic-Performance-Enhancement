*File to add â†’Â `docs/2_requirements/flashcards.md`*  
*(link it fromâ€¯`docs/README.md` and the project Tableâ€‘ofâ€‘Contents)*  

---

# ðŸ“šâ€¯Flashâ€‘Memory Layer â€” Authoring, Build & CIÂ SpecÂ vâ€¯1.0

> **Mission** â€“Â Guarantee we never reâ€‘learn the same thing twice, while keeping CI fast and the repo small.

---

## 0â€¯Â·â€¯Why flashcards live in the codeÂ repo

| Painâ€‘point | Flashâ€‘memory fix |
|------------|-----------------|
| Tribal knowledge evaporates when people switch projects. | Every durable insight becomes a *versionâ€‘controlled card*. |
| Docs readâ€‘once â†’ forgotten. | Spacedâ€‘repetition resurfaces them exactly when youâ€™re about to forget. |
| Unitâ€‘tests guard machines; nothing guards *humans*. | This layer is the **human testâ€‘suite**. |

---

## 1â€¯Â·â€¯Design principles

1. **Authorâ€‘first** â€“ editing a card must feel like editing Markdown.  
2. **One canonical source** â€“ *authoring YAML* is truth; everything else is compiled.  
3. **Zero CI drag** â€“ lint/yamlâ€‘schema <â€¯2â€¯s; heavy exports run outâ€‘ofâ€‘band.  
4. **Scales to 10âµ cards** â€“ no megabyte blobs in history; Parquet snapshots for logs.  
5. **Language minimalism** â€“ single Python toolâ€‘chain for parseÂ +Â export.  
6. **Security** â€“ guard against secrets, XSS, proprietary leaks.

---

## 2â€¯Â·â€¯Folder layout

```text
docs/
â””â”€ 5_flashcards/              # â† author here
   â”œâ”€ backend_2025Q2.yaml
   â”œâ”€ ml_pipeline.yaml
   â””â”€ taskmaster_cli.yaml

flashcore/                     # Python package
â””â”€ exporters/
   â”œâ”€ build_cards.py          # YAML  â†’ DuckDB ingest  (+UUID)
   â”œâ”€ export_anki.py          # DuckDBâ†’ .apkg (genanki)
   â””â”€ export_markdown.py      # DuckDBâ†’ flashcards.md

dist/
â””â”€ flashcards/                # autoâ€‘generated (.apkg, .md)
```

> **Rule** â€“Â never edit anything inÂ `dist/` or `flashcards/YYYY_MM/` by hand.

---

## 3â€¯Â·â€¯YAML schemaÂ (`*.yaml`)

```yaml
deck: Backend::Auth                 # namespaced deck
tags: [backend, auth]
cards:
  - id: 7b7c2d57-e7b8-4e1f-a793-0ee2a61bcb79  # optional; autoâ€‘filled if absent
    q:  "What does the AUTH middleware attach to req in v2?"
    a:  "`req.auth.userId`, `req.auth.scopes`"
    tags: [middleware]
    origin_task: 1423                         # TaskÂ Master id
    media: []                                 # optional list of asset paths
  - q: "Which CLI command regenerates task files?"
    a: "`task-master generate`"
```

### Validation rules

| Field | Rule |
|-------|------|
| `deck` | UTFâ€‘8, may include `::` for hierarchy |
| `id` | UUIDv4 (autogenerated if blank) |
| `q`, `a` | â‰¤â€¯1024â€¯chars each |
| `tags` | kebabâ€‘case list |
| `media` | path under `docs/5_flashcards/assets/` |
| **Forbidden** | `<script>` tags, absolute file paths, secrets regex |

Run locally:

```bash
python -m flashcore.exporters.build_cards --lint docs/5_flashcards/
```

---

## 4â€¯Â·â€¯Author workflow

### VSÂ Code snippet *(ships in `.vscode/snippets/flashcards.code-snippets`)*

```yaml
- q: "$1question?"
  a: "$2answer"
  tags: [$3]
```

1. Add card into the nearest deck file.  
2. `preâ€‘commit` hook autoâ€‘runs:

```
tm-fc vet docs/5_flashcards/backend_2025Q2.yaml
```

*Actions*: inject UUIDs, alphaâ€‘sort deck, deâ€‘dupe identical Q fronts.

---

## 5â€¯Â·â€¯Build pipeline

```bash
# one command, run anywhere
make flash-sync
```

1. **Build step** â€“Â `build_cards.py`  
   * YAML â†’ internal `Card` objects (fills UUID, normalises Markdown)  
   * Upserts into `duckdb://flash.db cards` table  
2. **Export step** â€“Â `export_anki.py`, `export_markdown.py`  
   * Writes `.apkg` (one per topâ€‘level deck) and combined `flashcards.md` into `dist/flashcards/`  
3. **(optional)** â€“ gzip artefacts (`dist/flashcards.zip`) for quick download.

> Average speed: ~7â€¯k cards / s on M2; the largest deck (65â€¯k cards) exports in \<â€¯10â€¯s.

---

## 6â€¯Â·â€¯CI integration

### 6.1Â Lint job (cheap; every PR)

`.github/workflows/flashcards-lint.yml`

```yaml
on: [pull_request]
jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
      - run: pip install "flashcore[dev]"
      - run: python -m flashcore.exporters.build_cards --lint docs/5_flashcards
```

### 6.2Â Build job (heavy; nightly)

`.github/workflows/flashcards-nightly.yml`

```yaml
schedule: [{ cron: "0 22 * * *" }]  # 22:00Â UTC
jobs:
  nightly:
    # checkout, setupâ€‘python â€¦
    - run: make flash-sync
    - uses: actions/upload-artifact@v4
      with: { name: flashcards, path: dist/flashcards }
```

Failures **do not** block main CI; they ping `#flashcards-alerts`.

---

## 7â€¯Â·â€¯TaskÂ Master hooks

*In `scripts/post_task_complete.py`*:

```python
if "[[fc]]" in task.description:
    tm_fc_add(front, back,
              deck=task.labels.domain,
              origin_task=task.id)
```

*`tm_fc_add`* is an alias for `tm-fc add`.

---

## 8â€¯Â·â€¯Security & compliance

| Check | Tool |
|-------|------|
| Secrets / IDs | `detect-secrets` in preâ€‘commit |
| HTML sanitise | `bleach` in `build_cards.py` |
| Licence footer | `export_anki.py` appends CCâ€‘BY to every back if env `FLASH_LICENCE=CC-BY-4.0`. |

---

## 9â€¯Â·â€¯Scaling guidelines

* **Shard** huge decks by quarter (`backend_2025Q2.yaml`).  
* **Archive** cards with `stability > 900Â days` **and** `lapses = 0`; move to `flashcards_archive/`.  
* Review DB size yearly; prune old `reviews/*parquet` beyond research horizon.

---

## 10â€¯Â·â€¯FAQ

| Q | A |
|---|---|
| *Can I embed LaTeX or images?* | Yes â€“Â use `$â€¦$` (autoâ€‘KaTeX) or put assets under `docs/5_flashcards/assets/`. |
| *What if two people add the same question?* | `tm-fc vet` flags duplicate fronts at commit time. |
| *Do I have to install Anki?* | No â€“Â Streamlit GUI (`tm-fc review --gui`) works inâ€‘browser. `.apkg` is for mobile/offline. |
| *Why YAML not Markdown tables?* | Easier machineâ€‘parse, supports multiâ€‘line answers & metadata without escaping nightmares. |

---

## 11â€¯Â·â€¯Roadmap tickets (MVP â†’Â Q2Â 2025)

| # | Title | Status |
|---|-------|--------|
| 45 | Define JSONâ€‘Schema & lint cmd | âœ… |
| 46 | Port Node builder â†’Â Python genanki | ðŸŸ¡ inâ€‘progress |
| 52 | PRâ€‘checklist bot for missing decks | ðŸ”² |
| 57 | Selective deck rebuild in CI | ðŸ”² |
| 60 | Superset â€œMemory Stabilityâ€ dashboard | ðŸ”² |

*(See GitHub project **Flashâ€‘Memory MVP** for live board.)*

---

## 12â€¯Â·â€¯TL;DRÂ cheatâ€‘sheet

```bash
# add a card quickly
tm-fc add -d Backend "Why use FSRS?" "Gives stability & difficulty metrics"

# run local build/test before pushing
make flash-sync && make test

# daily review
tm-fc review --gui
```

> **Never let knowledge rot.**  
> If it matters, put it in a card â€“ the scheduler will handle the rest.
